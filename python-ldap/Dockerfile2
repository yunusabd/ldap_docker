FROM python:3.9.6-slim-buster AS ldap-build

RUN apt-get update -y \
    && apt-get install -y --no-install-recommends gcc \
    # the --no-install-recommends helps limit some of the install so that you can be more explicit about what gets installed
    && apt-get install -y libsasl2-dev python-dev libldap2-dev libssl-dev \
    && python -m pip wheel --wheel-dir=/tmp python-ldap==3.3.1 ipython==7.26.0 \
    && rm -rf /var/lib/apt/lists/* \
    && apt-get purge -y --auto-remove gcc 

FROM python:3.9.6-slim-buster
COPY --from=ldap-build /tmp/*.whl /tmp/
RUN python -m pip install /tmp/*.whl

CMD tail -f /dev/null
